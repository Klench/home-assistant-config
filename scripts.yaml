################# SONOS #################

sonos_group_all_speakers:
  alias: Sonos group all speakers
  sequence:
    - service: sonos.join
      data:
        master: media_player.kok
        entity_id:
          - media_player.sovrum
          - media_player.vardagsrum

sonos_group_kitchen_livingroom_speakers:
  alias: Sonos group kitchen livingroom speakers
  sequence:
    - service: sonos.join
      data:
        master: media_player.kok
        entity_id:
          - media_player.vardagsrum

sonos_ungroup_bedroom_speaker:
  alias: Sonos ungroup bedroom speaker
  sequence:
    - service: sonos.unjoin
      entity_id: media_player.sovrum
    - service: media_player.volume_set
      data:
        entity_id: media_player.sovrum
        volume_level: 0.10

sonos_set_group_volume:
  alias: Sonos set group volume
  sequence:
    - service: media_player.volume_set
      data_template:
        entity_id: >
          {%- for sonos_speaker in states.media_player.kok.attributes.sonos_group -%}
          {{sonos_speaker}}{%- if not loop.last %},{% endif %}
          {%- endfor %}
        volume_level: '{{ volume }}'

sonos_sync_group_volume:
  alias: Sonos sync group volume
  sequence:
    - service: media_player.volume_set
      data_template:
        entity_id: >
          {%- for sonos_speaker in states.media_player.kok.attributes.sonos_group %}
          {%- if not loop.first -%}
          {{sonos_speaker}}{%- if not loop.last %},{% endif %}
          {%- endif %}
          {%- endfor %}
        volume_level: '{{  states.media_player.kok.attributes.volume_level | float  }}'

sonos_increase_volume:
  alias: 'Sonos increase volume'
  sequence:
    - service: media_player.volume_set
      data_template:
        entity_id: >
          {%- for sonos_speaker in states.media_player.kok.attributes.sonos_group -%}
          {{sonos_speaker}}{%- if not loop.last %},{% endif %}
          {%- endfor %}
        volume_level: '{{  states.media_player.kok.attributes.volume_level | float + 0.05  }}'

sonos_decrease_volume:
  alias: 'Sonos decrease volume'
  sequence:
    - service: media_player.volume_set
      data_template:
        entity_id: >
          {%- for sonos_speaker in states.media_player.kok.attributes.sonos_group -%}
          {{sonos_speaker}}{%- if not loop.last %},{% endif %}
          {%- endfor %}
        volume_level: '{{  states.media_player.kok.attributes.volume_level | float - 0.05  }}'

sonos_say:
  alias: "Sonos TTS script"
  sequence:
    - service: sonos.snapshot
      data_template:
        entity_id: "{{ 'media_player.' ~ sonos_entity }}"
    - service: sonos.unjoin
      data_template:
        entity_id:  "{{ 'media_player.' ~ sonos_entity }}"
    - service: media_player.volume_set
      data_template:
        entity_id:  "{{ 'media_player.' ~ sonos_entity }}"
        volume_level: "{{ volume }}"
    - service: tts.google_translate_say
      data_template:
        entity_id:  "{{ 'media_player.' ~ sonos_entity }}"
        message: "{{ message }}"
    - delay: '00:00:01'
    - delay: >-
        {% set duration = states.media_player[sonos_entity].attributes.media_duration %}
        {% if duration > 0 %}
          {% set duration = duration - 1 %}
        {% endif %}
        {% set seconds = duration % 60 %}
        {% set minutes = (duration / 60)|int % 60 %}
        {% set hours = (duration / 3600)|int %}
        {{ [hours, minutes, seconds]|join(':') }}
    - service: sonos.restore
      data_template:
        entity_id:  "{{ 'media_player.' ~ sonos_entity }}"
        with_group: true

sonos_set_alarm:
  alias: 'Sonos set alarm'
  sequence:
    - service: sonos.update_alarm
      data_template:
        entity_id: media_player.sovrum
        alarm_id: 7
        time: '{{ states.sensor.alarm_clock_time_weekdays.state }}'
        enabled: true

sonos_disable_alarm:
  alias: 'Sonos disable alarm'
  sequence:
    - service: sonos.update_alarm
      data_template:
        entity_id: media_player.sovrum
        alarm_id: 7
        enabled: false

sonos_enable_night_mode:
  alias: 'Sonos enable night mode'
  sequence:
    - service: sonos.set_option
      data:
         entity_id: media_player.vardagsrum
         night_sound: true
         speech_enhance: true

sonos_disable_night_mode:
  alias: 'Sonos disable night mode'
  sequence:
    - service: sonos.set_option
      data:
         entity_id: media_player.vardagsrum
         night_sound: false
         speech_enhance: false

################# Lights #################

##### HOME #####

all_rooms_bright:
  alias: 'Hög ljusstyrka'
  sequence:
    - service: script.bedroom_bright
    - service: script.livingroom_bright
    - service: script.hallway_bright
    - service: homeassistant.turn_on
      data:
        entity_id: automation.opening_bathroom_door
    - delay:
        milliseconds: 10

all_rooms_relaxed:
  alias: 'Mysbelysning'
  sequence:
    - service: script.bedroom_relaxed
    - service: script.livingroom_relaxed
    - service: script.hallway_relaxed
    - service: script.bathroom_relaxed
    - service: homeassistant.turn_off
      data:
        entity_id: automation.opening_bathroom_door
    - delay:
        milliseconds: 10

all_lights_off:
  alias: 'Allt släckt'
  sequence:
    - service: light.turn_off
      data:
        entity_id: group.all_lights
    - service: homeassistant.turn_on
      data:
        entity_id: automation.opening_bathroom_door
    - service: script.sonos_set_group_volume
      data:
        volume: 0.1
    - delay:
        milliseconds: 10

wakeup_lights:
  alias: 'Väckning'
  sequence:
    - service: script.bedroom_wakeup
    - delay:
        milliseconds: 10
    - service: script.livingroom_wakeup
    - delay:
        milliseconds: 10
    - service: script.hallway_wakeup

window_lights:
  alias: 'Skymningsbelysning'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.bedside_lamp_bedroom
    - service: light.turn_on
      data:
        entity_id: light.window_lamp_livingroom

go_to_bed_lights:
  alias: 'Gå till sängs'
  sequence:
    - service: light.turn_off
      data:
        entity_id: light.hue_ambiance_lamp_2
        transition: 300
    - service: light.turn_off
      data:
        entity_id: light.hue_ambiance_lamp_1
        transition: 1800
    - service: light.turn_off
      data:
        entity_id: light.hue_ambiance_lamp_1_3
        transition: 1800
    - service: light.turn_off
      data:
        entity_id: light.ceiling_lamp_hallway
        transition: 1800

watching_tv_lights:
  alias: 'Belysning TV-tittande'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_1_3
        brightness: 144
        color_temp: 443
        transition: 2
    - service: light.turn_on
      data:
        entity_id: light.window_lamp_livingroom
    - service: light.turn_on
      data:
        entity_id: light.ceiling_lamp_hallway
        brightness: 144
        transition: 2

##### BEDROOM #####

bedroom_bright:
  alias: 'Hög ljusstyrka'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_2
        brightness: 200
        color_temp: 372
        transition: 2

bedroom_relaxed:
  alias: 'Mysbelysning'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_2
        brightness: 144
        color_temp: 443
        transition: 2
    - service: light.turn_on
      data:
        entity_id: light.bedside_lamp_bedroom

baby_light_bedroom:
  alias: 'Bebisbelysning'
  sequence:
    - service: light.turn_off
      data:
        entity_id: light.bedside_lamp_bedroom
    - delay:
        milliseconds: 100
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_2
        brightness: 20
        color_temp: 455
        transition: 2

bedroom_wakeup:
  alias: 'Väckning sovrum'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_2
        brightness: 30
        color_temp: 372
        transition: 1800

##### LIVINGROOM #####

livingroom_bright:
  alias: 'Hög ljusstyrka'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_1
        brightness: 150
        color_temp: 372
        transition: 2
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_1_3
        brightness: 255
        color_temp: 372
        transition: 2

livingroom_relaxed:
  alias: 'Mysbelysning'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_1
        brightness: 100
        color_temp: 443
        transition: 2
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_1_3
        brightness: 144
        color_temp: 443
        transition: 2
    - service: light.turn_on
      data:
        entity_id: light.window_lamp_livingroom

livingroom_nursery_light:
  alias: 'Amning vardagsrum'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.window_lamp_livingroom

livingroom_wakeup:
  alias: 'Väckning vardagsrum'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_1
        brightness: 150
        color_temp: 372
        transition: 1800
    - service: light.turn_on
      data:
        entity_id: light.hue_ambiance_lamp_1_3
        brightness: 255
        color_temp: 372
        transition: 1800

##### HALLWAY #####

hallway_bright:
  alias: 'Hög ljusstyrka'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.ceiling_lamp_hallway
        brightness: 255
        transition: 2

hallway_relaxed:
  alias: 'Mysbelysning'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.ceiling_lamp_hallway
        brightness: 144
        transition: 2

hallway_wakeup:
  alias: 'Väckning hall'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.ceiling_lamp_hallway
        brightness: 200
        transition: 1800

##### BATHROOM #####

bathroom_relaxed:
  alias: 'Badrumsbelysning'
  sequence:
    - service: light.turn_on
      data:
        entity_id: light.bathroom_led
        brightness: 255
        rgb_color: [255,168,38]
        transition: 2
        effect: None

################# VARIOUS #################

livingroom_nursery:
  alias: 'Amning'
  sequence:
    - service: script.livingroom_nursery_light
    - service: script.bathroom_relaxed
    - service: script.sonos_enable_night_mode
    - service: homeassistant.turn_off
      data:
        entity_id: automation.opening_bathroom_door
    - delay: '01:00'
    - service: script.sonos_disable_night_mode
    - service: homeassistant.turn_on
      data:
        entity_id: automation.opening_bathroom_door

################# TRANSMISSION #################

transmission_add_torrent:
  alias: 'Lägg till torrent'
  sequence:
    - service: transmission.add_torrent
      data_template:
        name: Transmission
        torrent: '{{ states.input_text.transmission_torrent_url.state }}'